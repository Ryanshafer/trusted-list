import{j as e}from"./index.wX83TmGO.js";import{R as a}from"./index.MCg13cn8.js";import{r as Y}from"./requests.DZ_jtkNB.js";import{S as Z,A as _,a as Q,b as ee,d as se,e as te,f as ae,g as re,h as c,H as ne,C as le,R as ie,F as oe}from"./HelpRequestCards.eQ4pox4U.js";import{B as m,A as de,a as ce,b as me,D as ue,d as xe,E as he,e as pe,f,g as ge,h as fe,F as je}from"./card.DmnAMBxS.js";import{F as Ne,L as be,a as ve}from"./list.Bilu4OH3.js";import{M as we}from"./message-circle.CjfBP6WU.js";import"./index.Bo7hZKLy.js";const ye=Y;function $e({query:u}){const[R,k]=a.useState("all"),[i,j]=a.useState("grid"),[N,D]=a.useState(new Set),[r,x]=a.useState(null),[F,b]=a.useState(!1),[A,v]=a.useState([]),[$,w]=a.useState(""),[L,y]=a.useState(!1),[M,o]=a.useState(!1),[O,E]=a.useState("3 days"),[H,S]=a.useState(!1),[h,I]=a.useState(u??"");a.useEffect(()=>{if(u||typeof window>"u")return;const t=new URL(window.location.href).searchParams.get("q")||"";I(t)},[u]);const p=h.toLowerCase().trim(),d=a.useMemo(()=>ye.filter(s=>{const t=`${s.name} ${s.subtitle??""} ${s.requestSummary??""} ${s.request}`.toLowerCase();return p?t.includes(p):!0}).filter(s=>!N.has(s.id)),[p,N]),P=s=>{if(!s)return"No end date";const t=new Date(s);return Number.isNaN(t.getTime())?"No end date":t.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})},T=s=>{const t=s.requestSummary?.trim()??"",n=s.request.trim();return t?`${t.replace(/[.!?]\\s*$/,"")}. ${n}`:n},g=s=>{D(t=>new Set([...t,s]))},U=s=>{x(s),v([{id:Date.now(),sender:"contact",text:T(s)}]),b(!0)},z=s=>{x(s),o(!0)},B=s=>{x(s),y(!0)},V=({card:s,primaryLabel:t,onPrimary:n,onRemind:G,onCantHelp:W,onFlag:J,isLast:K})=>{const[C,q]=a.useState(!1),X=a.useMemo(()=>(s.name||"").split(" ").map(l=>l[0]).join("").slice(0,2).toUpperCase(),[s.name]);return e.jsx("div",{className:`hidden lg:block ${K?"":"border-b border-border/60"} bg-muted/10`,children:e.jsxs("div",{className:`grid grid-cols-12 gap-4 px-5 py-4 text-sm ${C?"items-start":"items-center"}`,children:[e.jsxs("div",{className:"col-span-3 flex items-center gap-3 min-w-0",children:[e.jsxs(de,{className:"h-10 w-10 border",children:[s.avatarUrl?e.jsx(ce,{src:s.avatarUrl,alt:s.name}):null,e.jsx(me,{children:X})]}),e.jsxs("div",{className:"flex flex-col min-w-0",children:[e.jsx("span",{className:"font-semibold leading-tight truncate",children:s.name}),e.jsx("span",{className:"text-xs text-muted-foreground leading-tight truncate",children:s.subtitle||s.relationshipTag})]})]}),e.jsxs("div",{className:"col-span-5 min-w-0",children:[e.jsx("div",{className:"font-semibold leading-tight mb-1 truncate",children:s.requestSummary||s.request}),e.jsx("div",{className:"text-sm text-muted-foreground leading-snug",children:C?e.jsxs(e.Fragment,{children:[s.request,e.jsx("button",{className:"ml-1 text-primary hover:underline font-medium",onClick:l=>{l.stopPropagation(),q(!1)},children:"less"})]}):e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"truncate",children:s.request}),s.request.length>80&&e.jsx("button",{className:"ml-1 whitespace-nowrap text-primary hover:underline font-medium",onClick:l=>{l.stopPropagation(),q(!0)},children:"more"})]})})]}),e.jsx("div",{className:"col-span-2 text-xs text-muted-foreground",children:e.jsx("div",{className:"truncate",children:P(s.endDate)})}),e.jsxs("div",{className:"col-span-2 flex items-center justify-end gap-2",children:[e.jsxs(m,{variant:"outline",className:"border-primary text-primary hover:bg-primary hover:text-primary-foreground",onClick:n,children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),t]}),e.jsxs(ue,{children:[e.jsx(xe,{asChild:!0,children:e.jsx(m,{variant:"ghost",size:"icon",className:"h-9 w-9",children:e.jsx(he,{className:"h-4 w-4"})})}),e.jsxs(pe,{align:"end",className:"w-52",children:[e.jsxs(f,{onClick:G,children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),"Remind me"]}),e.jsx(fe,{}),e.jsx(f,{onClick:W,children:"I can't help with this request"}),e.jsxs(f,{className:"text-destructive focus:text-destructive",onClick:J,children:[e.jsx(je,{className:"mr-2 h-4 w-4"}),"Flag as inappropriate"]})]})]})]})]})})};return e.jsxs(Z,{children:[e.jsxs("div",{className:"flex min-h-screen bg-background",children:[e.jsx(_,{}),e.jsxs(Q,{className:"flex min-h-screen w-full flex-1 flex-col overflow-x-hidden",children:[e.jsx("div",{className:"flex items-center gap-3 border-b bg-background px-4 py-3 lg:hidden",children:e.jsx(ee,{className:"border border-border"})}),e.jsx("div",{className:"flex-1 px-4 py-8 sm:px-6 lg:px-10",children:e.jsxs("div",{className:"mx-auto flex w-full max-w-7xl flex-col gap-6",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-3xl font-bold leading-tight tracking-tight sm:text-4xl",children:[e.jsx("a",{href:"/trusted-list/requests",className:"hover:underline",children:"All Requests"}),e.jsx("span",{className:"text-muted-foreground",children:"/"}),e.jsx("span",{children:h||"Search"})]}),e.jsxs("p",{className:"text-muted-foreground text-base",children:["Results for “",h||"All","”."]})]}),e.jsx("section",{className:"flex flex-col gap-4 rounded-xl border border-border/50 bg-muted/30 p-4 shadow-sm",children:e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs(se,{value:R,onValueChange:k,children:[e.jsxs(te,{className:"h-10 rounded-full border border-border bg-background px-4 shadow-sm flex items-center gap-2",children:[e.jsx(Ne,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Filter"}),e.jsx(ae,{placeholder:"Filter"})]}),e.jsxs(re,{children:[e.jsx(c,{value:"days",children:"Days old"}),e.jsx(c,{value:"weeks",children:"Weeks old"}),e.jsx(c,{value:"months",children:"Months old"}),e.jsx(c,{value:"all",children:"All time"})]})]})}),e.jsxs("div",{className:"flex items-center gap-2 rounded-full bg-muted/40 px-2 py-1.5",children:[e.jsx(m,{variant:"ghost",size:"icon",className:`h-9 w-9 ${i==="grid"?"bg-background shadow-sm":""}`,onClick:()=>j("grid"),children:e.jsx(be,{className:"h-4 w-4"})}),e.jsx(m,{variant:"ghost",size:"icon",className:`h-9 w-9 ${i==="list"?"bg-background shadow-sm":""}`,onClick:()=>j("list"),children:e.jsx(ve,{className:"h-4 w-4"})})]})]})}),e.jsxs("div",{className:i==="grid"?"grid gap-4 sm:grid-cols-2 xl:grid-cols-3":"space-y-3",children:[i==="grid"?d.map(s=>{const t=s.name.split(" ")[0]??s.name;return e.jsx("div",{className:"p-1",children:e.jsx(ne,{...s,primaryCTA:`Help ${t}`,onClear:()=>g(s.id)})},s.id)}):e.jsxs("div",{className:"hidden lg:block rounded-2xl border border-border bg-card shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-4 px-6 py-3 text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:[e.jsx("div",{className:"col-span-3",children:"Requestor"}),e.jsx("div",{className:"col-span-5",children:"Request"}),e.jsx("div",{className:"col-span-2",children:"End Date"}),e.jsx("div",{className:"col-span-2 text-right pr-2",children:"Action"})]}),d.map((s,t)=>{const n=s.name.split(" ")[0]??s.name;return e.jsx(V,{card:s,primaryLabel:`Help ${n}`,onPrimary:()=>U(s),onRemind:()=>z(s),onCantHelp:()=>g(s.id),onFlag:()=>B(s),isLast:t===d.length-1},s.id)})]}),d.length===0&&e.jsx("div",{className:"rounded-2xl border border-dashed border-primary/30 bg-primary/5 p-6 text-center text-sm text-muted-foreground",children:"No requests match this search yet."})]})]})})]})]}),e.jsx(le,{open:F,onOpenChange:b,contactName:r?.name||"",messages:A,composer:$,onComposerChange:w,onSend:s=>{s.trim()&&(v(t=>[...t,{id:Date.now(),sender:"user",text:s}]),w(""))}}),e.jsx(ie,{open:M,onOpenChange:o,selection:O,onSelectionChange:E,reminderActive:H,onSet:()=>{S(!0),o(!1)},onCancelReminder:()=>{S(!1),o(!1)}}),e.jsx(oe,{open:L,onOpenChange:y,requestorName:r?.name,requestorAvatarUrl:r?.avatarUrl,requestSummary:r?.requestSummary,requestText:r?.request||"",onSubmit:()=>{r&&g(r.id)}})]})}export{$e as default};
